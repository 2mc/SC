<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="949.54">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000; min-height: 12.0px}
p.p6 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #000000}
p.p7 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p10 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #0000bf}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ff}
span.s1 {color: #0000bf}
span.s2 {color: #007300}
span.s3 {color: #000000}
span.s4 {font: 9.0px Monaco; color: #007300}
span.s5 {color: #0027b9}
span.s6 {font: 12.0px Helvetica}
span.s7 {font: 12.0px Helvetica; color: #000000}
span.s8 {color: #0000ff}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><b>Time References and Automation</b></p>
<p class="p2"><br></p>
<p class="p3">The BEASTmulch library makes use of the concept of Time References, which are objects which provide time updates for things like automation. Although in a typical use case there might be only one reference, e.g. a soundfile player, in principle one can have as many time references as desired (multiple players, external clock sources, etc.).</p>
<p class="p2"><br></p>
<p class="p4"><b>Making an object into a Time Reference</b></p>
<p class="p2"><br></p>
<p class="p3">Any object can be a Time Reference providing it fulfils a number of requirements:</p>
<p class="p2"><br></p>
<p class="p3">1. When its base time changes, it must call the following to notify its dependants:</p>
<p class="p5"><br></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">this</span>.changed(<span class="s2">\time</span>, timeInSeconds, rateOfChange, referenceTime);</p>
<p class="p7"><br></p>
<p class="p3">Where <b>timeInSeconds</b> is the updated time, <b>rateOfChange</b> is the rate at which time is changing (this can be negative), and <b>referenceTime</b> is a time indicating when <b>timeInSeconds</b> was true. referenceTime should be in seconds since the application started so that it can be compared to Main.elapsedTime for purposes of correction. Normally <b>referenceTime</b> would be derived from the time stamp on a received OSC message or from some similar non-synchronous source. In the absence of such a source the time reference should just pass Main.elapsedTime for this argument.</p>
<p class="p2"><br></p>
<p class="p3">It is up to dependants how they use this information. Since dependants may need to update at different rates than the Time Reference they depend on, it may be necessary to store this data to allow for interpolation.</p>
<p class="p2"><br></p>
<p class="p3">Note that if the original source is from another computer it will be necessary to synchronise the two machines using a network time source.</p>
<p class="p2"><br></p>
<p class="p3">If capable of pausing, a source should notify its dependants that<span class="s3"> </span><span class="s4">\time</span> has changed with a rate of 0.</p>
<p class="p2"><br></p>
<p class="p3">2. If it can stop (for instance in the case of a sound file player), it must call the following to notify its dependants:</p>
<p class="p2"><br></p>
<p class="p6"><span class="s3"><span class="Apple-tab-span">	</span></span><span class="s1">this</span>.changed(<span class="s2">\stop</span>);</p>
<p class="p2"><br></p>
<p class="p3">Again it is up to dependants to interpret this, but stopping should normally be equivalent to<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p8"><span class="s5"><span class="Apple-tab-span">	</span></span><span class="s1">this</span>.changed(<span class="s2">\time</span>, 0, 0, <span class="s1">Main</span>.elapsedTime);<span class="s6">.</span></p>
<p class="p2"><br></p>
<p class="p3">Stopped sources need not continue to regularly update their time.</p>
<p class="p2"><br></p>
<p class="p3">3. If the base for the time reference changes (for instance when a sound file player loads a new file), it should notify its dependants:</p>
<p class="p2"><br></p>
<p class="p8"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">this</span>.changed(<span class="s2">\base</span>);</p>
<p class="p2"><br></p>
<p class="p3">4. It must register itself with BMTimeReferences as a reference.</p>
<p class="p9"><span class="Apple-tab-span">	</span></p>
<p class="p10"><span class="s3"><span class="Apple-tab-span">	</span></span>BMTimeReferences<span class="s3">.addReference(</span>this<span class="s3">);</span></p>
<p class="p2"><br></p>
<p class="p3">5. It must respond to the message 'path' with either nil or a String. Time References which derive from files (such as sound file players) should return the file's path in response to this message. Those which don't, should return nil. This functionality allows dependants to access the source for things such as GUI representations.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p3">6. It must respond to the message setTime(time) by setting its time in seconds accordingly, and notifying its dependants of the change.</p>
<p class="p2"><br></p>
<p class="p3">7. It must at least understand the messages 'play', 'stop', 'pause', and 'togglePlay'. If the implementation of any or all of<span class="Apple-converted-space">  </span>these messages would be inappropriate, it can return nil to indicate this.</p>
<p class="p2"><br></p>
<p class="p3">Generally speaking time references should update reasonably frequently (say 10 times a second or faster). Note that what is done with the updated data is up to the dependant object to determine.</p>
<p class="p2"><br></p>
<p class="p4"><b>BMTimeReferences</b></p>
<p class="p2"><span class="Apple-converted-space"> </span></p>
<p class="p3">The class BMTimeReferences provides a framework for accurate updating and interpolation of data from Time References. It serves as a centralised registry of time sources, and provides utility functions for updating time based on the current logical time. To obtain the current time for a reference, one can simple call</p>
<p class="p2"><br></p>
<p class="p8"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">BMTimeReferences</span>.currentTime(ref);</p>
<p class="p2"><br></p>
<p class="p3">for an updated time.</p>
<p class="p2"><br></p>
<p class="p4"><b>Notes on objects which use Time References</b></p>
<p class="p2"><span class="Apple-converted-space"> </span></p>
<p class="p3">In general objects should respond gracefully to any rate of change in time (faster or slower, backwards, or large leaps). Objects which make use of time sources should respond gracefully to current time values of nil, &lt; 0 or +/- inf.</p>
<p class="p2"><br></p>
<p class="p11"><span class="s3"><b>See also: </b><a href="Classes/Other/BMTimeReferences.html"><span class="s8">BMTimeReferences</span></a>, <a href="Classes/Automation/BMAbstractAutomator.html"><span class="s8">BMAbstractAutomator</span></a>, <a href="Classes/Automation/BMControllerAutomator.html"><span class="s8">BMControllerAutomator</span></a></span></p>
<p class="p2"><br></p>
<p class="p7"><br></p>
</body>
</html>
